process RECO = {
    untracked PSet maxEvents = {untracked int32 input = 100}

    service = MessageLogger
    {
        untracked vstring destinations = { "cout" }
        untracked vstring categories = {  "DDLParser", "FwkJob", "FwkReport"}
        untracked PSet cout = { untracked string threshold = "INFO"
	    untracked PSet INFO        = { untracked int32 limit = 10000 }
	    untracked PSet DDLParser = { untracked int32 limit = 0 }
	    untracked PSet FwkJob = { untracked int32 limit =10 }
	    untracked PSet FwkReport = { untracked int32 limit = 20 }
	}
    }
    
    
    // Loads the events from testbeam files
     source = NewEventStreamFileReader 
    {
	string fileName = "/home/hcalmtcc/data_tmp/mtcc.00002378.A.testStorageManager_0.0.dat"
	int32 max_event_size = 2000000
	int32 max_queue_depth = 5
    }  
#  source = PoolSource { 
#	untracked vstring fileNames = { 'file:/tmp/meridian/h2b.00014224.A.0.0.root'}
#    }
    
    #load conditions
    include "Configuration/EcalTB/data/readConfigurationH2_2007_v0.cff"

    #tb objects unpacker 
    module tbunpacker = HcalTBObjectUnpacker {
	untracked int32 HcalTriggerFED  = 1
	untracked int32 HcalSlowDataFED = -1
	untracked int32 HcalTDCFED      = 8
	untracked int32 HcalQADCFED      = 8
	untracked int32 HcalSourcePosFED = -1
	untracked bool IncludeUnmatchedHits = false
	untracked string ConfigurationFile = 'configQADCTDC.txt'
    }

    # ECAL TB unpacker
    #do not forget to modify EventFilter/EcalTBRawToDigi/data/Ecal07UnpackerData.cfi corresponding to your needs 
    module ecalTBunpack = ecalEBunpacker from "EventFilter/EcalTBRawToDigi/data/Ecal07UnpackerData.cfi"
    replace ecalTBunpack.produceEEdigi = true
    replace ecalTBunpack.produceEBdigi = false

    include "EventFilter/EcalTBRawToDigi/data/Ecal07UnpackerData.cfi"
    
    # Ecal TDC Reco
    module ecal2007TBH2TDCReconstructor= ecal2006TBH2TDCReconstructor from "RecoTBCalo/EcalTBTDCReconstructor/data/ecal2006TBH2TDCReconstructor.cfi"
    replace ecal2007TBH2WeightUncalibRecHit.rawInfoProducer   = "tbunpacker"
    replace ecal2007TBH2WeightUncalibRecHit.triggerDataProducer   = "tbunpacker"
    replace ecal2007TBH2TDCReconstructor.tdcZeros=
    {
	{
	    int32 startRun = 0
	    int32 endRun = 999999
	    double tdcZero = 1032.8
	}
    }

    ## ECAL Amplitude reconstruction
    module ecal2007TBH2WeightUncalibRecHit= ecal2007TBH2WeightUncalibRecHit from "RecoTBCalo/EcalTBRecProducers/data/ecal2006TBH2WeightUncalibRecHit.cfi"
    replace ecal2007TBH2WeightUncalibRecHit.digiProducer   = "ecalTBunpack"
    replace ecal2007TBH2WeightUncalibRecHit.EBdigiCollection = "ebDigis"
    replace ecal2007TBH2WeightUncalibRecHit.EEdigiCollection = "eeDigis"
    replace ecal2007TBH2WeightUncalibRecHit.tdcRecInfoProducer   = "ecal2007TBH2TDCReconstructor"


    module reco-pool-out = PoolOutputModule {
	untracked string fileName = "h2.ecalReco.root"
	untracked vstring outputCommands = {
            "keep *",
      	    "drop FEDRawDataCollection_*_*_*"
	}
    }    

    sequence unpack = { tbunpacker, ecalTBunpack } 
    sequence reco = { ecal2007TBH2TDCReconstructor , ecal2007TBH2WeightUncalibRecHit }
    path p = { unpack, reco }
    endpath ep = { reco-pool-out }
    
}

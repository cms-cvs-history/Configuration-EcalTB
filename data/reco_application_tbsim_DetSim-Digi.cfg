process Sim  = 
{


     include "FWCore/MessageLogger/data/MessageLogger.cfi"

#    service = MessageLogger
#    {
#	untracked vstring destinations = {"cout"}
#	untracked vstring categories = { "FwkJob","BeamProfileVtxGenerator","SimG4CoreGeometry" }
#        untracked vstring debugModules = { "VtxSmeared","g4SimHits" }
#	untracked PSet cout =
#	{
#        untracked string threshold = "DEBUG"  
#        untracked PSet DEBUG = { untracked int32 limit = 0 }
#        untracked PSet default = { untracked int32 limit = 0 }
#        untracked PSet FwkJob  = { untracked int32 limit = -1 } # but FwkJob category - those unlimitted
#        untracked PSet BeamProfileVtxGenerator = { untracked int32 limit = -1 }
#        untracked PSet SimG4CoreGeometry = { untracked int32 limit = -1 }
#	}
#    }
	   
   # service = Timing {}
   untracked PSet maxEvents = {untracked int32 input = 10}

   service = RandomNumberGeneratorService
   {
      untracked uint32 sourceSeed = 98765
      PSet moduleSeeds =
      {
         untracked uint32 VtxSmeared = 12345
         untracked uint32 g4SimHits = 9876
	 untracked uint32 ecalUnsuppressedDigis = 54321   
	 untracked uint32 SimEcalTBG4Object = 5432   
      }
   }
      

   include "SimG4CMS/EcalTestBeam/test/data/crystal1104.cff"

   # flat random E-gun
   #
   source = FlatRandomEGunSource
   {
#      untracked int32 maxEvents = 10
      untracked PSet PGunParameters =
      {
         # you can request more than 1 particle
         untracked vint32 PartID = {11}
         using common_beam_direction_parameters
         untracked double MinE   = 120.
         untracked double MaxE   = 120.
      }
      untracked int32 Verbosity = 0 # set to 1 (or greater)  for printouts
   }

   module VtxSmeared = BeamProfileVtxGenerator 
   {
         using common_beam_direction_parameters
         untracked double BeamSigmaX = 2.4               
         untracked double BeamSigmaY = 2.4
         untracked bool GaussianProfile = false
   }

   #
   #Geometry
   #   
   include "Geometry/EcalTestBeam/data/TBH4GeometryXML.cfi"

   es_module = TrackerGeometricDetESModule {}

   #
   # SIM : simulated hits + additional H4 TB objects 
   #
   include "Configuration/EcalTB/data/simulation_tbsim.cff"
   replace g4SimHits.Watchers = {
	 { 
	    string type = "EcalTBH4Trigger"
	    untracked bool verbose = false
#####IMPORTANT######## NUMBER OF EVENTS TO BE TRIGGERED 
	    untracked int32 trigEvents = 5
########################################################
	 }
   }
   replace g4SimHits.Physics.type = "SimG4Core/Physics/QGSP"

   #
   # DIGI : H4 TB digitization 
   #
   include "Configuration/EcalTB/data/digitization_tbsim.cff"

   # Root/Pool output
   #
   module o1 = PoolOutputModule 
   { 
      untracked string fileName = "ECALH4TB_detsim_digi.root" 
      untracked vstring outputCommands = {
      "keep *",
      "drop PSimHits_g4SimHits_*_Sim",
      "drop PCaloHits_g4SimHits_*_Sim",
      "keep PCaloHits_g4SimHits_EcalHitsEB_Sim",
      "keep PCaloHits_g4SimHits_CaloHitsTk_Sim",
      "keep PCaloHits_g4SimHits_EcalTBH4BeamHits_Sim"
      }
   }
   
   sequence doSimHits   = { VtxSmeared, g4SimHits }
   sequence doSimTB     = { SimEcalTBG4Object, SimEcalTBHodoscope, SimEcalEventHeader }
   sequence doEcalDigis = { mix, ecalUnsuppressedDigis }
   path p1 = { doSimHits, doSimTB, doEcalDigis }
   endpath outpath = { o1 }
   
}		
